clc;
clear;
close all;

pr1 = [-0.0292637; -0.991758; -0.0370102];
pr2 = [0.207251; -0.890438; -0.041481];
pr3 = [0.110734; -0.659217; -0.0425404];
pr4 = [0.538086; -0.645267; -0.0423213];
pr5 = [0.19871; -0.350747; -0.0421358];
pr6 = [-0.268011; -0.274137; -0.0431139];
pr7 = [0.344328; -0.181725; -0.0427557];
pr8 = [0.604132; -0.455176; 0.516972];
pr9 = [0.584089; -0.409489; 0.668913];
pr10 = [-0.169447; -0.719515; 0.668325];
pr11 = [-0.168961; -0.720273; 0.366359];
pr12 = [0.126828; -0.437287; -0.0426422];
pr13 = [-0.449848; 0.0300413; -0.0433828];
pr14 = [-0.309433; 0.0890085; -0.0433041];
pr15 = [0.0229975; -0.316639; -0.0427414];
pr16 = [0.181317; -0.306721; -0.0428454];
pr17 = [-0.170167; -0.716815; 0.413731];
pr18 = [0.582877; -0.404723; 0.61422];
pr19 = [0.326405; -0.136468; -0.0427864];
pr20 = [0.188285; -0.193801; -0.042864];
pr21 = [0.362099; -0.610718; -0.042594];
pr22 = [0.453574; -0.571767; -0.042391];
pr23 = [0.176137; 0.233894; -0.0425703];


pw1 = [0 ; 0 ; 0];
pw2 = [0.25; 0; 0];
pw3 = [0.25; 0.25; 0];
pw4 = [0.65; 0.1; 0];
pw5 = [0.45; 0.5; 0];
pw6 = [0.05; 0.75; 0];
pw7 = [0.65; 0.6; 0];
pw8 = [0.775; 0.25; 0.55];
pw9 = [0.775; 0.3; 0.7];
pw10 = [-0.025; 0.3; 0.7];
pw11 = [-0.025; 0.3; 0.4];
pw12 = [0.35; 0.45; 0];
pw13 = [0; 1.1; 0];
pw14 = [0.15; 1.1; 0];
pw15 = [0.3; 0.6; 0];
pw16 = [0.45; 0.55; 0];
pw17 = [-0.025; 0.3; 0.45];
pw18 = [0.775; 0.3; 0.65];
pw19 = [0.65; 0.65; 0];
pw20 = [0.5; 0.65; 0];
pw21 = [0.5; 0.2; 0];
pw22 = [0.6; 0.2; 0];
pw23 = [0.65; 1.05; 0];

pr = [pr1 pr2 pr3 pr4 pr5 pr6 pr7 pr8 pr9 pr10 pr11 pr12 pr13 pr14 pr15 pr16 pr17 pr18 pr19 pr20 pr21 pr22 pr23];
pw = [pw1 pw2 pw3 pw4 pw5 pw6 pw7 pw8 pw9 pw10 pw11 pw12 pw13 pw14 pw15 pw16 pw17 pw18 pw19 pw20 pw21 pw22 pw23];

% [pr1 pr2 pr3 pr4 pr5 pr6 pr7 pr8 pr9 pr10 pr11 pr12 pr13 pr14 pr15 pr16 pr17 pr18 pr19 pr20 pr21 pr22 pr23]
% [pw1 pw2 pw3 pw4 pw5 pw6 pw7 pw8 pw9 pw10 pw11 pw12 pw13 pw14 pw15 pw16 pw17 pw18 pw19 pw20 pw21 pw22 pw23]

Cpr = transpose(mean(transpose(pr)));
Cpw = transpose(mean(transpose(pw)));
% Cpw2 = (1/size(pw,2)*sum(pw.')).'
% size(pw,2)

qr = pr - Cpr;
qw = pw - Cpw;

H = qr * transpose(qw);


[U,sigma,V] = svd(H);

% Rotation matrics
Rhat = V * transpose(U)

% Translation vector
That = Cpw - Rhat * Cpr

HT1 = [-0.00020367 -0.000204895 1 0.191; -0.999982 -0.00599992 -0.000204895 0.351; 
    0.00599996 -0.999982 -0.00020367 0.642; 0 0 0 1];

% [0.775 ; 0.25 ; 0.50 ; 1]

TRhat = [Rhat That; 0 0 0 1];

TranslationW = [0.1 ; 0.1 ; 0. ; 1];
TranslationW2 = [0.1 ; 0.1 ; 0.];

TranslationR = inv(TRhat) * TranslationW

% TranslationW2 = Rhat * TranslationR2 + That
% TranslationW2 - That = Rhat * TranslationR2
TranslationR2 = inv(Rhat) * TranslationW2 - transpose(Rhat) * That

